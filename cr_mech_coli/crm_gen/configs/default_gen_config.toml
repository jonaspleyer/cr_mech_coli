# Default Generation Configuration for crm_gen
# =========================================================================
# Controls all parameters for the simulation and image generation pipeline.
# Used by `crm_gen run` and `crm_gen clone`.
# Parameters with [min, max] ranges will be sampled uniformly.
# If min == max, the exact value is used.

[pipeline]
output_dir = "./outputs"
n_simulations = 1                       # Number of simulations with different randomized parameters
n_frames = 20                           # Number of frames (saved iterations) per simulation
image_size = [1024, 1024]               # [width, height] in pixels
seed = 0                                # Random seed (0 = random)
n_workers = 0                           # Number of parallel workers (0 = all CPUs)
skip_synthetic = false                  # Only run simulation, skip synthetic image generation
delete_generated = false                # Delete raw generated images after creating synthetic ones

[simulation]
# All physics params as [min, max]. min == max means exact value.
# Defaults match cr_mech_coli defaults.

# Timing parameters
t_max = [100.0, 100.0]                  # Total simulation time in minutes
dt = [0.1, 0.1]                         # Time step in minutes

# Initial conditions
n_bacteria = [8, 8]                     # Range for initial bacteria count
border_distance = 400.0                 # Minimum distance from border for initial positions (pixels)
n_vertices = 8                          # Number of vertices per bacterium

# Growth parameters
growth_rate = [0.01, 0.01]              # Base growth rate (1/min)
growth_rate_std = [0.005, 0.005]        # Std of growth rate distribution at division (0.0-0.2 recommended; >0.3 may cause instability)
spring_length_threshold = [6.0, 6.0]    # Cell length at division (micrometers)

# Mechanics parameters
diffusion_constant = [0.0, 0.0]         # Brownian motion magnitude (um^2/min^2)
spring_tension = [1.0, 1.0]             # Spring tension between vertices (1/min)
rigidity = [2.0, 2.0]                   # Joint stiffness at connections
damping = [1.0, 1.0]                    # Damping constant (1/min)

# Cell-cell interaction parameters (Morse potential)
# Note: Only interaction_strength is writable via Python API.
interaction_strength = [0.1, 0.1]       # Interaction strength (um^2/min^2)

# Environment parameters
gel_pressure = [0.0, 0.0]               # Pressure from gel medium
surface_friction = [0.0, 0.0]           # Surface friction coefficient

[rendering]
# PyVista render settings for raw image generation
pixel_per_micron = 1.0                  # Resolution (pixels per micrometer)
kernel_size = 2                         # Rendering kernel size
noise = 0                               # Render noise (disabled for raw images)
bg_brightness = 0                       # Background brightness (disabled for raw images)
cell_brightness = 0                     # Cell brightness (disabled, handled in post-processing)
ambient = 0.3                           # Ambient lighting
diffuse = 0.7                           # Diffuse lighting
specular = 0.0                          # Specular highlighting (disabled)
specular_power = 0.0                    # Specular power (disabled)
metallic = 0.0                          # Metallic appearance (disabled)
pbr = false                             # Physics-based rendering (disabled)
ssao_radius = 0.0                       # Screen-space ambient occlusion (disabled)

[synthetic]
# The 7 optimised imaging parameters (output of `crm_gen fit`)
bg_base_brightness = 0.2845             # Base brightness for background (0.0-1.0)
bg_gradient_strength = 0.0185           # Illumination gradient intensity (0.0-1.0)
bac_halo_intensity = 0.439              # Halo effect intensity around bacteria (0.0-1.0)
bg_noise_scale = 22                     # Background illumination noise scale (1-25)
psf_sigma = 2.49                        # Point Spread Function (PSF) blur sigma (pixels); typical 0.5-2.0
peak_signal = 8964.939                  # Peak photon count for Poisson noise (higher = less noise)
gaussian_sigma = 0.003                  # Gaussian readout noise sigma (0.001-0.05)

# Per-frame jitter on the 7 optimised params above.
# 0.0 = exact values, 0.1 = Â±10% of each value, etc.
variation_factor = 0.0

# Toggle individual effects
apply_psf = true                        # Apply Point Spread Function blur
apply_poisson = true                    # Apply Poisson shot noise
apply_gaussian = true                   # Apply Gaussian readout noise

[background]
# Background generation parameters
consistent = true                       # Use the same background for all frames (for video)
dark_spot_size_range = [2, 5]           # Range of dark spot sizes (sigma values)
num_dark_spots_range = [0, 5]           # Range for number of dark spots
num_light_spots_range = [0, 0]          # Range for number of light spots (disabled)
texture_strength = 0.02                 # Fine texture strength (0.0-1.0)
texture_scale = 1.5                     # Texture smoothness (higher = smoother)
blur_sigma = 0.8                        # Gaussian blur sigma for optical effects

[halo]
# Halo effect parameters around bacteria
halo_type = "bright"                    # Type: "bright", "dark", or "mixed"
inner_width = 2.0                       # Width of inner halo in pixels
outer_width = 50.0                      # Total halo width in pixels
blur_sigma = 0.01                       # Gaussian blur sigma for halo transition (default 0.5)
fade_type = "exponential"               # Fade type: "linear", "exponential", or "gaussian"

[brightness]
# Bacteria brightness mode
mode = "original"                       # "age" (compute from cell age) or "original" (match from reference)
brightness_range = [0.5, 0.28]          # [young_brightness, old_brightness] for age mode
noise_strength = 0.28                   # Perlin-like noise strength for brightness variation (0-1)
